<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HELIOS NitroType Leaderboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet"/>
  <style>
    .font-lato { font-family: 'Lato', sans-serif; }
  </style>
</head>
<body class="bg-slate-900 text-gray-200 min-h-screen p-8 font-sans">
  <h1 class="text-4xl font-extrabold mb-2 text-yellow-400">HELIOS Team Leaderboard</h1>
  <p class="text-sm italic text-gray-400 mb-6">
    Last updated: <span id="updated-at" class="font-mono">Loading…</span>
  </p>

  <div class="flex space-x-6">
    <!-- Main table (3/4 width) -->
    <div class="w-3/4 overflow-x-auto">
      <table class="min-w-full bg-slate-800 border-2 border-yellow-400 rounded-lg overflow-hidden">
        <thead class="bg-slate-700">
          <tr>
            <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">#</th>
            <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Name &amp; Title</th>
            <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Role</th>
            <th id="th-join" class="px-4 py-3 text-left text-sm font-medium text-gray-300 cursor-pointer">
              Member Since <span id="icon-join"></span>
            </th>
            <th id="th-last" class="px-4 py-3 text-left text-sm font-medium text-gray-300 cursor-pointer">
              Last Race <span id="icon-last"></span>
            </th>
            <th id="th-races" class="px-4 py-3 text-right text-sm font-medium text-gray-300 cursor-pointer">
              Races <span id="icon-races"></span>
            </th>
          </tr>
        </thead>
        <tbody id="leaderboard" class="divide-y divide-slate-700"></tbody>
      </table>
    </div>

    <!-- Info boxes (1/4 width, right side) -->
    <div class="w-1/4 space-y-6">
      <!-- Days Left -->
      <div class="bg-slate-800 border-2 border-yellow-400 rounded-lg p-4 text-center">
        <div id="days-left" class="text-5xl font-extrabold text-yellow-300 mb-1"></div>
        <div class="text-sm text-gray-400 mb-2">days left in tournament</div>
        <div class="text-xs text-gray-400">
          June 25th 8 AM (PST/PDT) – July 23rd 8 AM (PST/PDT)
        </div>
      </div>
      <!-- Prizes -->
      <div class="bg-slate-800 border-2 border-yellow-400 rounded-lg p-4">
        <h2 class="text-lg font-semibold text-yellow-300 mb-2">Prizes</h2>
        <p class="text-sm">
          <span class="text-yellow-300 font-bold">1st</span> – 
          <span class="text-green-400 font-semibold">$10,000,000 NITRO CASH</span><br>
          <span class="text-yellow-300 font-bold">2nd</span> – 
          <span class="text-green-400 font-semibold">$5,000,000 NITRO CASH</span><br>
          <span class="text-yellow-300 font-bold">3rd</span> – 
          <span class="text-green-400 font-semibold">$2,000,000 NITRO CASH</span>
        </p>
      </div>
      <!-- Description -->
      <div class="bg-slate-800 border-2 border-yellow-400 rounded-lg p-4">
        <h2 class="text-lg font-semibold text-yellow-300 mb-2">Description</h2>
        <p class="text-sm text-gray-300 mb-2">
          Tracks each member’s races since June 25, 2025. Updated hourly (PST/PDT).
        </p>
        <p class="text-xs text-gray-400">
          We reserve the right to disqualify you from the tournament if we have good reason to believe that you have cheated (e.g. botting).
        </p>
      </div>
      <!-- Links -->
      <div class="bg-slate-800 border-2 border-yellow-400 rounded-lg p-4">
        <h2 class="text-lg font-semibold text-yellow-300 mb-2">Links</h2>
        <ul class="text-sm space-y-1">
          <li>
            <a href="https://www.nitrotype.com/team/HELIOS" target="_blank" class="underline">
              <span class="text-yellow-300">[HELIOS]</span>
              <span class="text-blue-300"> on Nitro Type</span>
            </a>
          </li>
          <li>
            <a href="https://padlet.com/icarus_/HELIOS" target="_blank" class="underline text-blue-300">
              Padlet
            </a>
          </li>
        </ul>
      </div>
      <!-- Credits -->
      <div class="bg-slate-800 border-2 border-yellow-400 rounded-lg p-4">
        <h2 class="text-lg font-semibold text-yellow-300 mb-2">Credits</h2>
        <p class="text-sm text-gray-300">
          Created by vioiynx<br>
          Medal icons from 
          <a href="https://www.vecteezy.com/free-vector/1st-2nd-3rd-place" target="_blank"
             class="underline text-blue-300">
            1st 2nd 3rd Place Vectors by Vecteezy
          </a>
        </p>
      </div>
    </div>
  </div>

  <script>
    // days left
    (()=>{
      const end=new Date('2025-07-23T08:00:00-07:00'),
            diff=end-new Date();
      document.getElementById('days-left').textContent=
        diff>0?Math.ceil(diff/86400000):0;
    })();

    fetch('data.json')
      .then(r=>r.json())
      .then(data=>{
        document.getElementById('updated-at').textContent=
          data.last_updated||'Unknown';
        let board=data.board||[];

        // track sort directions
        const sortDir={ join:true, last:true, races:true };

        const roleClasses={
          officer:     'border-2 border-blue-400 text-blue-400',
          captain:     'border-2 border-purple-400 text-purple-400',
          vicecaptain: 'border-2 border-green-400 text-green-400',
          member:      'text-gray-400'
        };

        // render table
        function render(){
          const tbody=document.getElementById('leaderboard');
          tbody.innerHTML='';
          let lastDelta=null, lastRank=0;
          board.forEach((it,idx)=>{
            const rank=(it.delta!==lastDelta?idx+1:lastRank);
            lastDelta=it.delta; lastRank=rank;
            let base='',hover='hover:bg-slate-700';
            if(rank===1){ base='bg-yellow-400/20'; hover='hover:bg-yellow-400/10'; }
            else if(rank===2){ base='bg-yellow-500/20'; hover='hover:bg-yellow-500/10'; }
            else if(rank===3){ base='bg-yellow-600/20'; hover='hover:bg-yellow-600/10'; }
            const rowClass=`cursor-pointer ${base} ${hover}`;

            let ordHtml=`${rank}`;
            if(rank<=3) ordHtml=
              `<img src="assets/${rank}st.png" alt="${rank}st" class="h-6 inline"/>`;

            const key=it.role.toLowerCase().replace(/\s+/g,''),
                  badgeClass=roleClasses[key]||roleClasses.member,
                  roleLabel=key==='vicecaptain'?'Vice Captain':
                             it.role.charAt(0).toUpperCase()+it.role.slice(1);

            const joinDate=it.joinStamp?new Date(it.joinStamp*1000).toLocaleDateString():'N/A',
                  lastDate=it.lastActivity?new Date(it.lastActivity*1000).toLocaleDateString():'N/A';

            const titleColor= rank<=3?'text-yellow-300/70':'text-gray-400',
                  titleHtml=it.title?`<div class="text-xs ${titleColor} mt-1">${it.title}</div>`:'';

            const tr=document.createElement('tr');
            tr.className=`${rowClass} align-middle`;
            tr.onclick=()=>window.location=`https://www.nitrotype.com/racer/${it.username}`;
            tr.title='View Nitro Type profile';
            tr.innerHTML=`
              <td class="px-4 py-3">${ordHtml}</td>
              <td class="px-4 py-3 text-yellow-300 font-semibold">
                ${it.displayName}${titleHtml}
              </td>
              <td class="px-4 py-3">
                <span class="px-2 py-0.5 rounded ${badgeClass} bg-transparent text-xs font-medium">
                  ${roleLabel}
                </span>
              </td>
              <td class="px-4 py-3">${joinDate}</td>
              <td class="px-4 py-3">${lastDate}</td>
              <td class="px-4 py-3 text-right">${it.delta||0}</td>
            `;
            tbody.appendChild(tr);
          });
        }

        // sort handlers
        document.getElementById('th-join').onclick=()=>{
          board.sort((a,b)=> sortDir.join
            ? a.joinStamp - b.joinStamp
            : b.joinStamp - a.joinStamp
          );
          sortDir.join=!sortDir.join;
          render();
        };
        document.getElementById('th-last').onclick=()=>{
          board.sort((a,b)=> sortDir.last
            ? a.lastActivity - b.lastActivity
            : b.lastActivity - a.lastActivity
          );
          sortDir.last=!sortDir.last;
          render();
        };
        document.getElementById('th-races').onclick=()=>{
          board.sort((a,b)=> sortDir.races
            ? a.delta - b.delta
            : b.delta - a.delta
          );
          sortDir.races=!sortDir.races;
          render();
        };

        render();
      })
      .catch(console.error);
  </script>
</body>
</html>
