<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>[HELIOS] $17 Million NTC Competition Leaderboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet"/>
  <style>
    .font-lato { font-family: 'Lato', sans-serif; }
    th.sortable { cursor: pointer; user-select: none; }
  </style>
</head>
<body class="bg-slate-900 text-gray-200 min-h-screen p-8 font-sans">
  <h1 class="text-4xl font-extrabold mb-2 text-yellow-400">
    [HELIOS] $17 Million NTC Competition Leaderboard
  </h1>
  <p class="text-sm italic text-gray-400 mb-6">
    Last updated: <span id="updated-at" class="font-mono">Loading…</span>
  </p>

  <div class="flex space-x-6">
    <!-- Main table (3/4) -->
    <div class="w-3/4 overflow-x-auto">
      <table class="min-w-full bg-slate-800 border-2 border-yellow-400 rounded-lg overflow-hidden">
        <thead class="bg-slate-700">
          <tr>
            <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">#</th>
            <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Name & Title</th>
            <th class="px-4 py-3 text-left text-sm font-medium text-gray-300">Role</th>
            <th id="th-join"   class="px-4 py-3 text-left text-sm font-medium text-gray-300 sortable">
              Member Since <span>▼</span>
            </th>
            <th id="th-last"   class="px-4 py-3 text-left text-sm font-medium text-gray-300 sortable">
              Last Race <span>▼</span>
            </th>
            <th id="th-races" class="px-4 py-3 text-right text-sm font-medium text-gray-300 sortable">
              Races <span>▼</span>
            </th>
          </tr>
        </thead>
        <tbody id="leaderboard" class="divide-y divide-slate-700"></tbody>
      </table>
    </div>

    <!-- Info boxes (1/4) -->
    <div class="w-1/4 space-y-6">
      <!-- Countdown -->
      <div class="bg-slate-800 border-2 border-yellow-400 rounded-lg p-4 text-center">
        <div id="countdown" class="text-4xl font-extrabold text-yellow-300 mb-1"></div>
        <button id="toggle-countdown"
                class="mt-2 px-3 py-1 bg-gray-700 text-sm rounded">
          Show days only
        </button>
        <div class="text-sm text-gray-400 mt-2 mb-2">days left in tournament</div>
        <div class="text-xs text-gray-400">
          June 25th 8 AM (PST/PDT) – July 23rd 8 AM (PST/PDT)
        </div>
      </div>
      <!-- Prizes -->
      <div class="bg-slate-800 border-2 border-yellow-400 rounded-lg p-4">
        <h2 class="text-lg font-semibold text-yellow-300 mb-2">Prizes</h2>
        <p class="text-sm">
          <span class="text-yellow-300 font-bold">1st</span> – 
          <span class="text-green-400 font-semibold">$10,000,000 NITRO CASH</span><br>
          <span class="text-yellow-300 font-bold">2nd</span> – 
          <span class="text-green-400 font-semibold">$5,000,000 NITRO CASH</span><br>
          <span class="text-yellow-300 font-bold">3rd</span> – 
          <span class="text-green-400 font-semibold">$2,000,000 NITRO CASH</span>
        </p>
      </div>
      <!-- Description -->
      <div class="bg-slate-800 border-2 border-yellow-400 rounded-lg p-4">
        <h2 class="text-lg font-semibold text-yellow-300 mb-2">Description</h2>
        <p class="text-sm text-gray-300 mb-2">
          Tracks each member’s races since June 25, 2025. Updated hourly (PST/PDT).
        </p>
        <p class="text-xs text-gray-400">
          We reserve the right to disqualify you from the tournament if we have good reason to believe that you have cheated (e.g. botting).
          Please make sure you are adhering to 
          <a href="https://www.nitrotype.com/support/tos/" target="_blank"
             class="underline text-blue-300">
            Nitro Type's TOS
          </a>.Thank you!
        </p>
      </div>
      <!-- Links -->
      <div class="bg-slate-800 border-2 border-yellow-400 rounded-lg p-4">
        <h2 class="text-lg font-semibold text-yellow-300 mb-2">Links</h2>
        <ul class="text-sm space-y-1">
          <li>
            <a href="https://www.nitrotype.com/team/HELIOS" target="_blank"
               class="underline">
              <span class="text-yellow-300">[HELIOS]</span>
              <span class="text-blue-300"> on Nitro Type</span>
            </a>
          </li>
          <li>
            <a href="https://padlet.com/icarus_/HELIOS" target="_blank"
               class="underline text-blue-300">
              Padlet
            </a>
          </li>
        </ul>
      </div>
      <!-- Credits -->
      <div class="bg-slate-800 border-2 border-yellow-400 rounded-lg p-4">
        <h2 class="text-lg font-semibold text-yellow-300 mb-2">Credits</h2>
        <p class="text-sm text-gray-300 mb-1">Website created by vioiynx.</p>
        <p class="text-sm text-gray-300">
          Medal icons by
          <a href="https://www.vecteezy.com/free-vector/1st-2nd-3rd-place" target="_blank"
             class="underline text-blue-300">
            1st 2nd 3rd Place Vectors by Vecteezy
          </a>.
        </p>
      </div>
    </div>
  </div>

  <script>
    // Countdown and toggle
    const countdownEl = document.getElementById('countdown');
    const toggleBtn   = document.getElementById('toggle-countdown');
    let showExact = true;

    function updateCountdown() {
      const end = new Date('2025-07-23T08:00:00-07:00');
      let diff = end - new Date();
      if (diff < 0) diff = 0;
      const days  = Math.floor(diff / 86400000);
      const hours = Math.floor(diff % 86400000 / 3600000);
      const mins  = Math.floor(diff % 3600000 / 60000);
      const secs  = Math.floor(diff % 60000 / 1000);
      if (showExact) {
        countdownEl.textContent =
          String(days).padStart(2,'0')+':' +
          String(hours).padStart(2,'0')+':' +
          String(mins).padStart(2,'0')+':' +
          String(secs).padStart(2,'0');
      } else {
        countdownEl.textContent = days;
      }
    }

    toggleBtn.addEventListener('click', () => {
      showExact = !showExact;
      toggleBtn.textContent = showExact ? 'Show days only' : 'Show exact countdown';
      updateCountdown();
    });

    setInterval(updateCountdown, 1000);
    updateCountdown();

    // Sorting logic
    const sortStates = { join: false, last: false, races: false };
    let rowsData = [];

    function clearArrows() {
      ['join','last','races'].forEach(k => {
        document.getElementById(`th-${k}`).querySelector('span').textContent = '▼';
      });
    }

    function sortBy(key) {
      sortStates[key] = !sortStates[key];
      clearArrows();
      document.getElementById(`th-${key}`)
              .querySelector('span')
              .textContent = sortStates[key] ? '▲' : '▼';

      const dir = sortStates[key] ? 1 : -1;
      rowsData.sort((a,b) => {
        if (key === 'races') return dir * (a.delta - b.delta);
        return dir * (a[key] - b[key]);
      });
      renderRows();
    }

    document.addEventListener('DOMContentLoaded', () => {
      ['join','last','races'].forEach(k => {
        document.getElementById(`th-${k}`)
                .addEventListener('click', () => sortBy(k));
      });

      fetch('data.json')
        .then(r => r.json())
        .then(data => {
          document.getElementById('updated-at').textContent = data.last_updated || 'Unknown';
          let lastDelta = null, lastRank = 0;
          rowsData = data.board.map((it, idx) => {
            const rank = (it.delta !== lastDelta) ? idx + 1 : lastRank;
            lastDelta = it.delta; lastRank = rank;
            return {
              rank,
              ...it,
              join: it.joinStamp  || 0,
              last: it.lastActivity || 0
            };
          });
          renderRows();
        })
        .catch(console.error);
    });

    function renderRows() {
      const tbody = document.getElementById('leaderboard');
      tbody.innerHTML = '';
      rowsData.forEach(it => {
        let base='', hover='hover:bg-slate-700';
        if (it.rank === 1) { base='bg-yellow-400/20'; hover='hover:bg-yellow-400/10'; }
        else if (it.rank === 2) { base='bg-yellow-500/20'; hover='hover:bg-yellow-500/10'; }
        else if (it.rank === 3) { base='bg-yellow-600/20'; hover='hover:bg-yellow-600/10'; }
        const rowClass = `cursor-pointer ${base} ${hover}`;

        let ordHtml = `${it.rank}`;
        if (it.rank <= 3) {
          ordHtml = `<img src="assets/${it.rank}st.png" alt="${it.rank}st" class="h-6 inline" />`;
        }

        const roleKey = it.role.toLowerCase().replace(/\s+/g,'');
        const roleClasses = {
          officer:      'border-2 border-blue-400 text-blue-400 bg-transparent',
          captain:      'border-2 border-purple-400 text-purple-400 bg-transparent',
          vicecaptain:  'border-2 border-green-400 text-green-400 bg-transparent',
          member:       'text-gray-400'
        };
        const badgeClass = roleClasses[roleKey] || roleClasses.member;
        let roleLabel = it.role.charAt(0).toUpperCase()+it.role.slice(1);
        if (roleKey === 'vicecaptain') roleLabel = 'Vice Captain';

        const joinDate = it.join ? new Date(it.join*1000).toLocaleDateString() : 'N/A';
        const lastDate = it.last ? new Date(it.last*1000).toLocaleDateString() : 'N/A';

        const titleColor = it.rank <= 3 ? 'text-yellow-300/70' : 'text-gray-400';
        const titleHtml = it.title ? `<div class="text-xs ${titleColor} mt-1">${it.title}</div>` : '';

        const tr = document.createElement('tr');
        tr.className = `${rowClass} align-middle`;
        tr.onclick   = () => window.open(`https://www.nitrotype.com/racer/${it.username}`, '_blank');
        tr.title     = 'View Nitro Type profile';
        tr.innerHTML = `
          <td class="px-4 py-3">${ordHtml}</td>
          <td class="px-4 py-3 text-yellow-300 font-semibold">
            ${it.displayName}
            ${titleHtml}
          </td>
          <td class="px-4 py-3">
            <span class="px-2 py-0.5 rounded ${badgeClass} text-xs font-medium">
              ${roleLabel}
            </span>
          </td>
          <td class="px-4 py-3">${joinDate}</td>
          <td class="px-4 py-3">${lastDate}</td>
          <td class="px-4 py-3 text-right">${it.delta||0}</td>
        `;
        tbody.appendChild(tr);
      });
    }
  </script>
</body>
</html>
